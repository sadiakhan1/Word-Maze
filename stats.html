<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="stats.js"></script>
    <title>Document</title>
</head>
<body>
  
<!--Page types-->
<div class="navbar">
    <a href = "settings.html">Settings</a>
    <a href = "index.html">Home</a>
    <a href= "stats.html">Statistics</a>
</div>

<div class="stats-container">
<div class = "Games Played"> Games Played: <span id="gamesPlayed">0</span></div>
<div class = "Win Rate"> Win Rate: <span id="winRate">0</span>%</div>
<div class = "Average Time"> Average Time: <span id="averageTime">0</span> seconds</div>
</div>

<button id="updateStats">Update Stats</button>

</body>
</html>

<script>
            // Check if the userId cookie exists; if not, create one
            if (!document.cookie.includes('userId')) {
            const userId = Math.random().toString(36).substring(2); // Generate a random user ID
            document.cookie = `userId=${userId}; path=/;`; // Set the cookie
            console.log(`Assigned new userId: ${userId}`);
        }

        // Function to fetch user stats from the server
        function fetchStats() {
            fetch('/stats')
                .then(response => {
                    if (!response.ok) throw new Error('Error fetching stats');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('gamesPlayed').textContent = data.gamesPlayed || 0;
                    document.getElementById('winRate').textContent = data.winRate || '0.00';
                    document.getElementById('averageTime').textContent = data.averageTime || '0.00';
                })
                .catch(error => console.error('Fetch error:', error));
        }

        // Function to send a request to update stats
        function updateStats() {
            fetch('/stats/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ isWin: true, timeTaken: 30 }) // Example data for testing
            })
                .then(response => {
                    if (!response.ok) throw new Error('Error updating stats');
                    return response.text();
                })
                .then(data => {
                    console.log(data);
                    fetchStats(); // Refresh stats after updating
                })
                .catch(error => console.error('Update error:', error));
        }

        // Add event listener to the button for updating stats
        document.getElementById('updateStats').addEventListener('click', updateStats);

        // Fetch stats on page load
        fetchStats();
</script>